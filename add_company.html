<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="UTF-8">
    <title>法人アクセス履歴</title>
    <meta name="author" content="株式会社アンシャンテ">
    <meta name="copyright" content="&copy; COPYRIGHT © 株式会社アンシャンテ ALL RIGHTS RESERVED.">
    <meta name="robots" content="all">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/add_company.css">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  </head>

  <body>
    <div>
      <header>
      </header>


    <form>
      <table>
        <thead>
          <tr>
            <th><label for="domain">ドメイン名</label></th>
            <th><label for="company_name">法人名</label></th>
            <th><label for="prefecture_id">都道府県</label></th>
            <th><label for="address">住所</label></th>
            <th><label for="tel">電話</label></th>
            <th><label for="fax">FAX</label></th>
            <th><label for="url">URL</label></th>
            <th><label for="company_mynumber">法人番号</label></th>
          </tr>
        </thead>

        <tbody>
          <tr>
<!-- ID既にcfm上にあり -->
            <td><input type="text" id="domain" name="domain" required autocomplete="off" oninput="return deleteSpace(this);"></td>
            <td><input type="text" id="company_name" name="company_name" required autocomplete="off"></td>
            <td><input type="text" id="prefecture_id" name="prefecture_id" required autocomplete="off" oninput="return deleteSpace(this);"></td>
            <td><input type="text" id="address" name="address" required autocomplete="off" oninput="return deleteSpace(this);"></td>
            <td><input type="text" id="tel" name="tel" required autocomplete="off" oninput="return deleteSpace(this);"></td>
            <td><input type="text" id="fax" name="fax" autocomplete="off" oninput="return deleteSpace(this);"></td>
            <td><input type="text" id="url" name="url" required autocomplete="off" oninput="return deleteSpace(this);"></td>
            <td><input type="text" id="company_mynumber" name="company_mynumber" required autocomplete="off" oninput="return deleteSpace(this);"></td>
          </tr>
        </tbody>
      </table>

<!-- 送信ボタン：データ重複対策（クリックの回数制限） id足す-->
<input type="submit" value="送信", onclick="return validation()" id="sendButton">
<input type="button"  value="クリック制限解除" onclick="return initializeCountUpSendBtn()">
    </form>

    <!-- 既にcfm上にあり -->
    <div id="example_filter">
      <form>検索
        <input type="text" name="submit2" id="submit2">
      </form>
    </div>

      <table>
        <thead>
          <tr>
            <th>反映</th>
            <th>ドメイン名&nbsp;▼</th>
            <th>法人名&nbsp;▼</th>
            <th>都道府県&nbsp;▼</th>
            <th>住所&nbsp;▼</th>
            <th>電話&nbsp;▼</th>
            <th>FAX&nbsp;▼</th>
            <th>URL&nbsp;▼</th>
            <th>法人番号&nbsp;▼</th>
          </tr>
        </thead>

        <tbody>
            <tr>
              <td><a class="reflectionTrigger">⬆︎</a></td>
              <td><span class="search_domain">0010gw10.futaba.co.jp</span></td>
              <td><span class="search_company_name">双葉電子工業株式会社</span></td>
              <td><span class="search_prefecture_id">千葉県</span></td>
              <td><span class="search_address">茂原市大芝629</span></td>
              <td><span class="search_tel">0475-24-1111</span></td>
              <td><span class="search_fax">0475-23-1346</span></td>
              <td><span class="search_url">http://www.futaba.co.jp/</span></td>
              <td><span class="search_company_mynumber">9040001059420</span></td>
            </tr>
            <tr>
              <td><a class="reflectionTrigger">⬆︎</a></td>
              <td><span class="search_domain">clients.idec.co.jp</span></td>
              <td><span class="search_company_name">IDEC株式会社</span></td>
              <td><span class="search_prefecture_id">大阪府</span></td>
              <td><span class="search_address">大阪市淀川区西宮原２丁目６番６４号</span></td>
              <td><span class="search_tel">06-6398-2500</span></td>
              <td><span class="search_fax">06-6398-2540</span></td>
              <td><span class="search_url">http://jp.idec.com/ja/top</span></td>
              <td><span class="search_company_mynumber">6120001053789</span></td>
            </tr>
            <tr>
              <td><a class="reflectionTrigger">⬆︎</a></td>
              <td><span class="search_domain">nat204.pca.co.jp</span></td>
              <td><span class="search_company_name">ピー・シー・エー株式会社</span></td>
              <td><span class="search_prefecture_id">東京都</span></td>
              <td><span class="search_address">千代田区富士見1-2-21PCAビル</span></td>
              <td><span class="search_tel">03-5211-2700</span></td>
              <td><span class="search_fax"></span></td>
              <td><span class="search_url">http://www.pca.co.jp</span></td>
              <td><span class="search_company_mynumber">4010001027327</span></td>
            </tr>
        </tbody>
      </table>


      <script>
      // 反映↑ボタン
      reflectBtn();

        // 前の/次のページを押した時
        // ID既にcfm上にあり
        $("#example_previous").on('click', function(){
          reflectBtn();
        });

        $("#example_next").on('click', function(){
          reflectBtn();
        });

      function reflectBtn(){
        $('.reflectionTrigger').on('click', function () {
          setTr = $(this).parent().parent();

          domain = $(setTr).find(".search_domain");
          company = $(setTr).find(".search_company_name");
          prefecture = $(setTr).find(".search_prefecture_id");
          address = $(setTr).find(".search_address");
          phone = $(setTr).find(".search_tel");
          fax = $(setTr).find(".search_fax");
          url = $(setTr).find(".search_url");
          idNumber = $(setTr).find(".search_company_mynumber");
          allElements = [domain, company, prefecture, address, phone, fax, url, idNumber]

          domainForm = document.getElementById("domain");
          companyForm = document.getElementById("company_name");
          prefectureForm = document.getElementById("prefecture_id");
          addressForm = document.getElementById("address");
          phoneForm = document.getElementById("tel");
          faxForm = document.getElementById("fax");
          urlForm = document.getElementById("url");
          idNumberForm = document.getElementById("company_mynumber");
          allFormColums = [domainForm, companyForm, prefectureForm, addressForm, phoneForm, faxForm, urlForm, idNumberForm]

          for (i = 0; i < allFormColums.length; i++) {
            $(allFormColums)[i].value = $(allElements)[i][0].innerText;
          }
        });
      };

      // 送信時：入力欄制限
// 送信ボタン：データ重複対策（クリックの回数制限）
var countUpSendBtn = 0;
let sendButton = document.getElementById("sendButton");

function validation(){
  countUpSendBtn++;
  if (countUpSendBtn == 1) {
    domainForm = document.getElementById("domain");
    companyForm = document.getElementById("company_name");
    prefectureForm = document.getElementById("prefecture_id");
    addressForm = document.getElementById("address");
    phoneForm = document.getElementById("tel");
    faxForm = document.getElementById("fax");
    urlForm = document.getElementById("url");
    idNumberForm = document.getElementById("company_mynumber");
    allFormColums = [domainForm, companyForm, prefectureForm, addressForm, phoneForm, faxForm, urlForm, idNumberForm]

    var notAccepted = [
      />/g, /</g, /=/g, /＞/g, /＜/g, /＝/g, /;/g, /；/g, /[?]/
    ]

    for (i = 0; i < allFormColums.length; i++) {
      for (n = 0; n < notAccepted.length; n++) {
        if ($(allFormColums[i]).val().match(notAccepted[n])){
          alert("許可されていない記号が含まれています。\n【例】>　<　=　＞　＜　＝　;　；");
          $(allFormColums[i]).val(function(i, v) {
            return v.replace(notAccepted[n], '');
          });
sendButton.disabled = true;
          return false;
        }
      }
    }

    // 全角半角スペースを自動で削除
    for (i = 0; i < allFormColums.length; i++) {
      $(allFormColums[i]).val(function(i, v) {
        return v.replace(/\s+/g, "");
      });
    }

    // 法人番号入力欄(半角数字の入力のみを許可/13桁の入力を必須とする)
    if ($(idNumberForm)[0].value.length !== 13 || !$(idNumberForm)[0].value.match(/^[0-9]+$/)) {
      alert("法人番号は13字以内の半角数字で入力してください");
      $(idNumberForm).css('border', '1px solid #FF0000');
      $(idNumberForm)[0].value ="";
sendButton.disabled = true;
      return false;
    } else {
      $(idNumberForm).css('border', '1px solid #999');
      return true;
    }
  } else {
    sendButton.disabled = true;
  }
};

// 送信ボタン：制限解除
function initializeCountUpSendBtn() {
  countUpSendBtn = 0;
  sendButton.disabled = false;
};


// function validation(){
      //   domainForm = document.getElementById("domain");
      //   companyForm = document.getElementById("company_name");
      //   prefectureForm = document.getElementById("prefecture_id");
      //   addressForm = document.getElementById("address");
      //   phoneForm = document.getElementById("tel");
      //   faxForm = document.getElementById("fax");
      //   urlForm = document.getElementById("url");
      //   idNumberForm = document.getElementById("company_mynumber");
      //   allFormColums = [domainForm, companyForm, prefectureForm, addressForm, phoneForm, faxForm, urlForm, idNumberForm]
      //
      //   var notAccepted = [
      //     />/g, /</g, /=/g, /＞/g, /＜/g, /＝/g, /;/g, /；/g, /[?]/
      //   ]
      //
      //   for (i = 0; i < allFormColums.length; i++) {
      //     for (n = 0; n < notAccepted.length; n++) {
      //       if ($(allFormColums[i]).val().match(notAccepted[n])){
      //         alert("許可されていない記号が含まれています。\n【例】>　<　=　＞　＜　＝　;　；");
      //         $(allFormColums[i]).val(function(i, v) {
      //           return v.replace(notAccepted[n], '');
      //         });
      //         return false;
      //       }
      //     }
      //   }
      //
      //   // 全角半角スペースを自動で削除
      //   for (i = 0; i < allFormColums.length; i++) {
      //     $(allFormColums[i]).val(function(i, v) {
      //       return v.replace(/\s+/g, "");
      //     });
      //   }
      //
      //   // 法人番号入力欄(半角数字の入力のみを許可/13桁の入力を必須とする)
      //   if ($(idNumberForm)[0].value.length !== 13 || !$(idNumberForm)[0].value.match(/^[0-9]+$/)) {
      //     alert("法人番号は13字以内の半角数字で入力してください");
      //     $(idNumberForm).css('border', '1px solid #FF0000');
      //     $(idNumberForm)[0].value ="";
      //     return false;
      //   }
      // };



      // 入力時スペースを削除
      function deleteSpace(text) {
        text.value = text.value.replace(/\s+/g, "");
      }
      // 検索ウィンドウで下3桁のみを残す(2回目からはこれをdisable)
      // ID既にcfm上にあり
      window.addEventListener('DOMContentLoaded', function (event) {
        var searchContainer = document.getElementById( "example_filter" );
        var searchWindow = $(searchContainer).find("input");
        var countUp = 0;
        $(searchWindow).on('input', function(){
          countUp++;
          var searchWord = $(searchWindow).val();
          if (countUp == 1) {
            if (searchWord.length > 0) {
              // 全角半角スペースを自動で削除
              $(searchWindow).val(function(i, v) {
                 return v.replace(/\s+/g, "");
               });
              // サブドメイン 以外削除
              getExtension = searchWord.split(".").slice(-3);
              searchWord = getExtension.join(".");
              $(searchWindow).val(searchWord);
            }
          } else {
            if (searchWord.length > 0) {
              $(searchWindow).val(function(i, v) {
                 return v.replace(/\s+/g, "");
               });
            }
          }
        });
      });


      // 入力時：法人番号入力欄(半角数字の入力のみを許可/13桁の入力を必須とする)
      $('#company_mynumber').focusout(function(e) {
        $(this).css('border', '1px solid #FF0000');
        if ($(this)[0].value.length !== 13 || !$(this)[0].value.match(/^[0-9]+$/)) {
          alert("法人番号は13字以内の半角数字で入力してください");
           $(this)[0].value ="";
        }
      });

      </script>
    </div>

    <script src="js/jquery-3.3.1.min.js"></script>
  </body>
</html>
